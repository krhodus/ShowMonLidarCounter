<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ShowMon Lidar Car Counter</title>
<style>
body { background:black; font-family:Arial; color:white; margin:25px; }
.center { display:block; margin:auto; width:40%; }
.card {
  background:#222; padding:18px; border-radius:10px;
  margin-bottom:20px; box-shadow:0 3px 10px rgba(0,0,0,0.4);
}
.valueBox {
  background:#eee; color:black; padding:10px 18px;
  border-radius:6px; font-size:24px; display:inline-block; min-width:90px;
}
.led {
  display:inline-block; width:16px; height:16px; border-radius:50%;
  margin-left:10px; background:red;
}
.led.green { background:#00c000; }
button {
  padding:10px 20px; font-size:16px; margin:5px;
  border:none; border-radius:6px; cursor:pointer;
}
button.blue { background:#007bff; color:white; }
button.red { background:#c00000; color:white; }
</style>
</head>

<body>

<img src="https://ldplights.com/wp-content/uploads/2025/11/ShowMon_Logo.png" class="center">

<h1 class="center">Lidar Car Counter</h1>

<div class="card">
  <h2>Live Sensor</h2>
  <div>Distance: <span id="dist" class="valueBox">--</span> mm</div><br>
  <div>Strength: <span id="str" class="valueBox">--</span></div><br>
  <div>Car Present: <span id="present" class="valueBox">--</span></div>
</div>

<div class="card">
  <h2>Schedule Status</h2>
  <div>Schedule Valid:
    <span id="schedValidLED" class="led"></span>
  </div>
  <div>Schedule Active:
    <span id="schedActiveLED" class="led"></span>
  </div>
  <div>Last Fetch:
    <span id="schedFetch" class="valueBox">--</span>
  </div>
  <div>Status:
    <span id="schedStatus" class="valueBox">--</span>
  </div>
  <br>
  <button class="blue" onclick="refreshSchedule()">Refresh Schedule</button>
</div>

<script>
async function loadStatus() {
  try {
    let r = await fetch("/api/status");
    let j = await r.json();

    dist.textContent = j.last_distance_mm ?? "--";
    str.textContent = j.last_strength ?? "--";
    present.textContent = j.car_present ? "YES" : "NO";

    schedValidLED.className = j.schedule_valid ? "led green" : "led";
    schedActiveLED.className = j.schedule_active ? "led green" : "led";

    schedFetch.textContent = j.schedule_last_fetch_utc ?? "--";
    schedStatus.textContent = j.schedule_last_status ?? "--";

  } catch(e) { console.log(e); }
}

async function refreshSchedule() {
  let r = await fetch("/api/schedule/refresh", {method:"POST"});
  loadStatus();
}

setInterval(loadStatus, 2000);
loadStatus();
</script>

</body>
</html>
